
/*  */
/* USAR LA REGLA QUE YA TENEMOS HECHA!!! LA 1 (SACAR 1 FUNCION FUERA Y REUTILIZAR) */
/* PODEMOS USAR EXPRESIONES REULARES EN TODASS */
/*  */



/* A) Nombre: Elf, etiqueta: practicaYARA_A */
rule Elf : practicaYARA_A

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify ELF files"
    
    strings:
        
        $a = {7f 45 4c 46}
        

    condition:
        
        $a at 0

}


/* B) Nombre: PE, etiqueta: practicaYARA_B */
rule PE : practicaYARA_B

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify PE files"
    
    strings:
        
        $a = {4D 5A}
        // $a = MZ
        

    condition:
        
        $a at 0

}


/* C) Nombre: BigElf, etiqueta: practicaYARA_C */
rule BigElf : practicaYARA_C

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify ELF files > 500KB"
    
    strings:
        
        $a = {7f 45 4c 46}
        

    condition:
        filesize > 500KB and 
        $a at 0

}


/* D) Nombre: GPL, etiqueta: practicaYARA_D */
rule GLP : practicaYARA_D

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify ELF files with GPL version 2 or 3"
    
    strings:
        
        $a = {7f 45 4c 46}
        $b = /GNU GPL version (2|3) or later/
    
    condition:
        
        $b and 
        $a at 0

}


/* E) Nombre: Bin, etiqueta: practicaYARA_E */
rule Bin : practicaYARA_E

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify BIN files"
    
    strings:
        
        $a = {38 45 1e a5 99 ee ?? ?? ?? ?? 59 c4 c3 0a f2 88}
    
    condition:
        
        $a

}


/* F) Nombre: Indentation, etiqueta: practicaYARA_F */
rule Indentation : practicaYARA_F

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify ELF files > 50KB whit program ... deep"
    
    strings:
        
        $a = {7f 45 4c 46}
        $b = "program indentation level too deep" nocase


    condition:
        filesize > 50KB and 
        $b and 
        $a at 0 

}


/* G) Nombre: BinOff, etiqueta: practicaYARA_G */
rule BinOff : practicaYARA_G

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify BIN files"
    
    strings:
        
        $a = {6d c8 7a 4e ad ca 07 c3}
    
    condition:
        
        $a in (0xb7b0..0xb970)

}


/* H) Nombre: Integer, etiqueta: practicaYARA_H */
rule Integer : practicaYARA_H

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify ELF files > 50KB whit program ... deep"
    
    strings:
        
        $a = {7f 45 4c 46}
        

    condition:
        filesize < 20KB and 
        $a at 0 and 
        (int32(121000) or int32(121002) or int32(18821))

}





/* A) Nombre: Regex, etiqueta: practicaYARA_I */
rule Regex : practicaYARA_I

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify ELF files"
    
    strings:
        
        $a = {7f 45 4c 46}
        $b = {4D 5A}
        $c = "USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND"
        $str = "gdm"
        $rgx = /\b([a-z]+)\s+[0-9]+\s+[0-9]+.[0-9]+\s+[0-9].[0-9]\s+[0-9]+\s+[0-9]+\s+(\?|[a-z0-9|\/]+)\s+[a-zA-Z|+]+\s+[0-9]+:[0-9]+\s+[0-9]+:[0-9]+\s+([^\r\n]+)/
        


    condition:
        
        not $a at 0 and
        not $b at 0 and 
        $c at 0 and
        

}


