
/* EXPRESIONES REGULARES */


/* A) Nombre: Elf, etiqueta: practicaYARA_A */
rule Elf : practicaYARA_A

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify ELF files"
    
    strings:
        
        $a = {7f 45 4c 46}

    condition:
        
        $a at 0

}


/* B) Nombre: PE, etiqueta: practicaYARA_B */
rule PE : practicaYARA_B

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify PE files"
    
    strings:
        
        $b = {4D 5A}
        
    condition:
        
        $b at 0

}


/* C) Nombre: BigElf, etiqueta: practicaYARA_C */
rule BigElf : practicaYARA_C

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify ELF files > 500KB"
    
    condition:
        filesize > 500KB and 
        Elf 

}


/* D) Nombre: GPL, etiqueta: practicaYARA_D */
rule GPL : practicaYARA_D

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify ELF files with GPL version 2 or 3"
    
    strings:
        
        $d = /GNU GPL version (2|3) or later/
    
    condition:
        
        $d and 
        Elf

}


/* E) Nombre: Bin, etiqueta: practicaYARA_E */
rule Bin : practicaYARA_E

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify BIN files"
    
    strings:
        
        $e = {38 45 1e a5 99 ee ?? ?? ?? ?? 59 c4 c3 0a f2 88}
    
    condition:
        
        $e

}


/* F) Nombre: Indentation, etiqueta: practicaYARA_F */
rule Indentation : practicaYARA_F

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify ELF files > 50KB whit program ... deep"
    
    strings:
        
        $f = "program indentation level too deep" nocase

    condition:
        filesize > 50KB and 
        $f and 
        Elf

}


/* G) Nombre: BinOff, etiqueta: practicaYARA_G */
rule BinOff : practicaYARA_G

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify BIN files"
    
    strings:
        
        $g = {6d c8 7a 4e ad ca 07 c3}
    
    condition:
        
        $g in (0xb7b0..0xb970)

}


/* H) Nombre: Integer, etiqueta: practicaYARA_H */
rule Integer : practicaYARA_H

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify ELF files < 20KB whit hex*"
    
    strings:
        $hex1 = {a8d80100}
        $hex2 = {aad80100}
        $hex3 = {85490000}


    condition:
        filesize < 20KB and 
        Elf and 
        2 of ($hex*)
}


/* I) Nombre: Regex, etiqueta: practicaYARA_I */
rule Regex : practicaYARA_I

{
    meta:
        
         authorname =   "Gabriel Medrano Sanchez"
         authomail =    "g.medrano.2020@alumnos.urjc.es"
         description =  "Identify with Regex"
    
    strings:
        
        $c = "USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND"
        $gdm = /(gdm([^\r\n]+))/
        $lockd = /\b(root\s+1[0-9]{3}([^\r\n]+)\[lockd\])[^-]/
        
    condition:
        
        // not Elf and PE:
        not Elf and
        not PE and 
        
        //ps aux at 0:
        $c at 0 and

        // root locked = (1000-1999):
        $lockd and

        // gdm process > 20
        $gdm and
        #gdm > 20
        
}


/*EXAM  RULES*/

rule R1 : EXAMENMAYO1
{

    meta:
        authorname =   "Gabriel Medrano Sanchez"

    strings:
        $a = {44 11 45 55 [0-600] 41 33 21 41 12 43 53}

    condition:
        $a

}

rule R2 : EXAMENMAYO2
{
    meta:
        authorname =   "Gabriel Medrano Sanchez"
    
    strings:
        $b = {68 74 74 70 73 3a 2f}

    condition:
        $b at 0x3030 or $b at 0x4440

}

rule R3 : EXAMENMAYO3
{
    meta:
        authorname =   "Gabriel Medrano Sanchez"

    strings:
        $c = /[A-Za-z0-9\.]{1,100}@evildomain.com/

    condition:
	 $search in (0x3000..0x4440)

}
