# as -o hello.o hello.s
# ld -o hello hello.o


.data 
    buffer: .space 1024
    file:   .ascii "/etc/passwd"
    cont:   .quad 10 
    msg:    .ascii "hey!!\n"


.text

.global _start


_start:

    # Primero abrimos el fichero:
    movq $2, %rax       # Número de la syscall para open
    movq $file, %rdi   # Dirección del nombre del archivo
    movq $0, %rsi       # Modo de apertura (sólo lectura)
    syscall

loop:
    # Leo fichero estandar en bucle mientras me devuelva > 0:
    mov $0, %rax
    mov $file, %rdi
    mov $buffer, %rsi       # se carga la dirección de buffer en rsi
    mov $1024, %rdx
    syscall 
    
    # Imprimo cadena estandar:
    mov   $1, %rax    # RAX holds syscall 1 (write).
    mov   $1, %rdi    # RDI holds file descriptor 1
    mov   $buffer, %rsi  # RSI holds the address of our string buffer.
    mov   $1024, %rdx    # RDX holds the size our of string buffer.
    syscall           # Invoke a syscall with these arguments.

	# Prueba (eliminar)
	movq	$1, %rax   # 1 is write
	movq	$1, %rdi
	movq	$msg, %rsi
	movq	$6, %rdx
	syscall
	
	subq	$1, cont  # Resta 1 a cont
	jnz	loop      # Si no es 0 salta, si es 0 para. Ideal para bucles.

	movq	$60, %rax  # 60 is exit
	movq	$0, %rdi
	syscall
    
